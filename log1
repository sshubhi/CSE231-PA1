
> web-asm-jit@0.0.1 test /home/sshubhi/CSE231/pa1-sshubhi
> env TS_NODE_COMPILER_OPTIONS='{"module": "commonjs" }' mocha -r ts-node/register 'tests/**/*.test.ts'



  traverseExpr(c, s) function
    ✓ parses a number in the beginning

  traverseStmt(c, s) function
Printing for MY TEST!!!!!!!

    ✓ parses a statement

  parse(source) function
traversed 1 statements  [ { tag: 'expr', expr: { tag: 'num', value: 987 } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 3,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
    ✓ parse a number

  run(source, config) function
traversed 1 statements  [ { tag: 'expr', expr: { tag: 'num', value: 987 } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 3,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
traversed 1 statements  [ { tag: 'expr', expr: { tag: 'num', value: 987 } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 3,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
Generated:  (local $$last i32)
(i32.const 987)
(local.set $$last)
MY TEST!!! 

(module
    (func $print (import "imports" "print") (param i32) (result i32))
    (func $abs (import "imports" "abs") (param i32) (result i32))
    (func $pow (import "imports" "pow") (param i32) (param i32) (result i32))
    (func $max (import "imports" "max") (param i32) (param i32) (result i32))
    (func $min (import "imports" "min") (param i32) (param i32) (result i32))
    (func (export "exported_func") (result i32)
      (local $$last i32)
(i32.const 987)
(local.set $$last)
      (local.get $$last)
    )
  )
    ✓ returns the right number (84ms)
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 11,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 11,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
Generated:  (local $$last i32)
(i32.const 1337)
(call $print)
(local.set $$last)
MY TEST!!! 

(module
    (func $print (import "imports" "print") (param i32) (result i32))
    (func $abs (import "imports" "abs") (param i32) (result i32))
    (func $pow (import "imports" "pow") (param i32) (param i32) (result i32))
    (func $max (import "imports" "max") (param i32) (param i32) (result i32))
    (func $min (import "imports" "min") (param i32) (param i32) (result i32))
    (func (export "exported_func") (result i32)
      (local $$last i32)
(i32.const 1337)
(call $print)
(local.set $$last)
      (local.get $$last)
    )
  )
    ✓ prints something right
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 10,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 10,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
Generated:  (local $$last i32)
(i32.const 987)
(call $print)
(local.set $$last)
MY TEST!!! 

(module
    (func $print (import "imports" "print") (param i32) (result i32))
    (func $abs (import "imports" "abs") (param i32) (result i32))
    (func $pow (import "imports" "pow") (param i32) (param i32) (result i32))
    (func $max (import "imports" "max") (param i32) (param i32) (result i32))
    (func $min (import "imports" "min") (param i32) (param i32) (result i32))
    (func (export "exported_func") (result i32)
      (local $$last i32)
(i32.const 987)
(call $print)
(local.set $$last)
      (local.get $$last)
    )
  )
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 10,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'builtin1', name: 'print', arg: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 10,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
Generated:  (local $$last i32)
(i32.const 123)
(call $print)
(local.set $$last)
MY TEST!!! 

(module
    (func $print (import "imports" "print") (param i32) (result i32))
    (func $abs (import "imports" "abs") (param i32) (result i32))
    (func $pow (import "imports" "pow") (param i32) (param i32) (result i32))
    (func $max (import "imports" "max") (param i32) (param i32) (result i32))
    (func $min (import "imports" "min") (param i32) (param i32) (result i32))
    (func (export "exported_func") (result i32)
      (local $$last i32)
(i32.const 123)
(call $print)
(local.set $$last)
      (local.get $$last)
    )
  )
    ✓ prints two numbers but returns last one (52ms)
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'binary', arg1: [Object], op: '+', arg2: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 5,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }
traversed 1 statements  [ { tag: 'expr',
    expr: { tag: 'binary', arg1: [Object], op: '+', arg2: [Object] } } ] stopped at  BufferNode {
  context:
   BufferContext {
     parent: TreeNode { node: [Tree], from: 0, index: 0, _parent: null },
     buffer:
      TreeBuffer {
        buffer: [Uint16Array],
        length: 5,
        set: [NodeSet],
        type: [NodeType] },
     index: 0,
     start: 0 },
  _parent: null,
  index: 0,
  type:
   NodeType {
     name: 'ExpressionStatement',
     props: [Object: null prototype] { '2': [Array] },
     id: 83,
     flags: 0 } }

 printing now :   

[ '(i32.const 2)', '(i32.const 3)' ]

 done printing!!
Printing SUMIRAN's debug messages:

[ '(i32.const 2)', '(i32.const 3)', '(i32.add)' ]
Generated:  (local $$last i32)
(i32.const 2)
(i32.const 3)
(i32.add)
(local.set $$last)
MY TEST!!! 

(module
    (func $print (import "imports" "print") (param i32) (result i32))
    (func $abs (import "imports" "abs") (param i32) (result i32))
    (func $pow (import "imports" "pow") (param i32) (param i32) (result i32))
    (func $max (import "imports" "max") (param i32) (param i32) (result i32))
    (func $min (import "imports" "min") (param i32) (param i32) (result i32))
    (func (export "exported_func") (result i32)
      (local $$last i32)
(i32.const 2)
(i32.const 3)
(i32.add)
(local.set $$last)
      (local.get $$last)
    )
  )
    ✓ adds two numbers


  7 passing (187ms)

